@using KKday.Web.B2D.BE.Models.Model.Common
@using KKday.Web.B2D.BE.Models.Model.FixedPrice
@using Resources
@inject ILocalizer localizer
@model List<FixedPricePackageEx>
@{
    Layout = "_LayoutMain"; 

    var prod = ViewData["PRODUCT"] as FixedPriceProductEx;
    var query_params = ViewData["QUERY_PARAMS"] as QueryParamsModel;
}
@section Stylesheet {
    <link rel="stylesheet" href="~/css/collapse_arrows.css">
    <style type="text/css">
        .price-table { margin-bottom: 8px; }
    </style>
}
 
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="@Url.Content("~/KKday")">Home</a></li>
        <li class="breadcrumb-item">@localizer.Text.Title_Distributor</li>
        <li class="breadcrumb-item active" aria-current="page">固定價設定</li>
    </ol>
</nav>

<div class="container">
    <div class="row"> 
        <div class="col-xs-12">
            <h4>固定價設定</h4>
        </div>

        <div class="col-xs-12">
            <span style="font-size: 1.18em; display: block; margin: 16px 0 16px 0; color: #0174DF;">
                    @prod.COMPANY_NAME
            </span>
        </div>
    </div> <!-- row -->

    <div class="row"> 
        <div class="col-xs-12" style="margin-bottom: 8px;">
             
            #@prod.PROD_NO @prod.PROD_NAME

            <button class="btn btn-info" onclick="SyncPackage('@prod.XID'); return false;">
                <span class="glyphicon glyphicon glyphicon-refresh"></span> 同步
            </button>
        </div>

        <div id="list_pkg" class="col-xs-12">
             @await Html.PartialAsync("_EditPkgPrice", Model)
        </div>

         <div id="import_pkg" class="col-xs-12" style="display:none;">
         </div>
    </div> <!-- row -->

    <div class="row">
        <div class="col-xs-12">
            @if (query_params != null)
            {
                <ul class="pagination pull-right">
                    @if (query_params.Paging.total_pages > 1)
                    {
                        <li><a href="javascript:Refresh(1, false);"><span class="glyphicon glyphicon-chevron-left"></span></a></li>
                    }
                    @for (int nIdx = 0; nIdx < query_params.Paging.total_pages; nIdx++)
                    {
                        var pgIdx = nIdx + 1;
                        if (pgIdx == query_params.Paging.current_page)
                        {
                            <li class="active"><a href="javascript:void(0);">@pgIdx</a></li>
                        }
                        else
                        {
                            <li><a href="javascript:void(0);" onclick="Refresh(@pgIdx, false);">@pgIdx</a></li>
                        }
                    }
                    @if (query_params.Paging.total_pages > 1)
                    {
                        <li><a href="javascript:Refresh(@query_params.Paging.total_pages, false);"><span class="glyphicon glyphicon-chevron-right"></span></a></li>
                    }
                </ul>
            }
        </div>
    </div> <!-- row -->

    <div class="row">
        <div class="col-xs-12">
            <hr />
            <button type="button" class="btn btn-default" onclick="window.history.go(-1);">回上一頁</button>
        </div>
    </div>

</div>

<script type="text/javascript">

    $(function(){

    });

    function SyncPackage(pid) {
        console.log("Sync Operations...");

        $.getJSON( _root_path + "FixedPrice/SyncPackageAsync/"+ pid ,function(result){
            // console.log(JSON.stringify(result));
            if(result.status == "OK") {
                $("#list_pkg").hide();
                $("#import_pkg").show();

                $("#import_pkg").html(result.content);
            } else {
                alert(result.msg);
            }
        
        });
    }

    function RestorePage(){
         $("#list_pkg").show();
         $("#import_pkg").hide();
    }

</script>